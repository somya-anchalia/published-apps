<form version="1.1">
    <label>Malware inbox</label>
    <fieldset submitButton="false">
        <input type="time" token="time_restriction">
            <label>Time restriction</label>
            <default>
                <earliest>-30d@d</earliest>
                <latest>now</latest>
            </default>
        </input>
        <input type="dropdown" token="selected_input_name" searchWhenChanged="true">
            <label>Host input</label>
            <search>
                <query>| `cybereason_configured_inputs("base_url")`</query>
                <earliest>$time_restriction.earliest$</earliest>
                <latest>$time_restriction.latest$</latest>
            </search>
            <default>*</default>
            <choice value="*">All</choice>
            <fieldForLabel>base_url</fieldForLabel>
            <fieldForValue>base_url</fieldForValue>
        </input>
        <input type="dropdown" token="selected_classification_type">
            <label>Malware classification type</label>
            <default>*</default>
            <choice value="*">All</choice>
            <choice value="KnownMalware">Known Malware</choice>
            <choice value="FilelessMalware">Fileless Malware</choice>
            <choice value="ApplicationControlMalware">Application Control Malware</choice>
            <choice value="RansomwareMalware">Ransomware Malware</choice>
            <choice value="UnknownMalware">Unknown Malware</choice>
        </input>
    </fieldset>
    <row id="tabs">
        <panel>
            <html>
                <ul id="tabs" class="nav nav-tabs">
                    <li class="active">
                        <a href="#" class="toggle-tab" data-toggle="tab" data-elements="row_malware_1">Malware overview</a>
                    </li>
                </ul>
            </html>
        </panel>
    </row>
    <row id="row_malware_1">
        <panel>
            <title>Details</title>
            <table>
                <search>
                    <query>host="$selected_input_name$" eventtype=cybereason_malware id.malwareType="$selected_classification_type$"
| rename ownerMachine.elementValues{}.name AS machine_name, avScanTime as tmp_scan_time avRemediationStatus as remediation_status malwareDataModel.processName as process_name id.malwareType as malware_type
| eval new_time=tonumber(substr(tostring(tmp_scan_time),0,10)), new_created_time = tonumber(substr(tostring(timestamp),0,10))
| rename new_time as new_scan_time 
| convert ctime(new_scan_time) AS scan_time ctime(new_created_time) as created_time timeformat="%Y-%m-%d %T %Z"
| eval path = coalesce(path, file_path, process_name), remediation_status = coalesce(remediation_status, status), machine_name = coalesce(machine_name, dest), scan_time = coalesce(scan_time, date)
| fields - new_scan_time, tmp_scan_time, new_created_time
| stats values(name) as name values(type) as classification_type values(remediation_status) as remediation_status values(machine_name) as machine_name  values(path) as path latest(created_time) as created_time by guid 
| sort 0 - created_time 
| rename name as Name, guid as Guid, created_time as "Created Time" path as Path, machine_name as "Machine name", remediation_status as "Remediation status", classification_type as "Classification type"
                    </query>
                    <earliest>$time_restriction.earliest$</earliest>
        <latest>$time_restriction.latest$</latest>
                </search>
                <option name="drilldown">none</option>
                <option name="refresh.display">progressbar</option>
                <option name="wrap">false</option>
            </table>
        </panel>
    </row>
</form>